
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents additional data for a user, linked to Firebase Authentication. Stores business information and user role.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity, corresponding to the Firebase Authentication UID."
        },
        "businessName": {
          "type": "string",
          "description": "The name of the client's business or organization."
        },
        "contactName": {
          "type": "string",
          "description": "The name of the primary contact person for the business."
        },
        "email": {
          "type": "string",
          "description": "The email address associated with the user's account.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "The contact phone number for the business."
        },
        "streetAddress": {
          "type": "string",
          "description": "The street address of the business."
        },
        "city": {
          "type": "string",
          "description": "The city of the business address."
        },
        "state": {
          "type": "string",
          "description": "The state or province of the business address."
        },
        "zipCode": {
          "type": "string",
          "description": "The postal code of the business address."
        },
        "role": {
          "type": "string",
          "description": "The role of the user within the application (client, admin, or superadmin)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the user profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the user profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "businessName",
        "contactName",
        "email",
        "phoneNumber",
        "streetAddress",
        "city",
        "state",
        "zipCode",
        "role",
        "createdAt",
        "updatedAt"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available for wholesale ordering.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the product."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to an image of the product.",
          "format": "uri"
        },
        "stockQuantity": {
          "type": "number",
          "description": "The current quantity of the product available in stock."
        },
        "price": {
          "type": "number",
          "description": "The wholesale price of one unit of the product."
        },
        "category": {
          "type": "string",
          "description": "The category the product belongs to (e.g., 'Frutas', 'Verduras')."
        },
        "unitOfMeasure": {
          "type": "string",
          "description": "The unit in which the product is measured and sold (e.g., 'kg', 'lb', 'caja')."
        },
        "active": {
          "type": "boolean",
          "description": "Indicates whether the product is currently active and available for purchase."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the product was added to the catalog.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the product details were last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "stockQuantity",
        "price",
        "category",
        "unitOfMeasure",
        "active",
        "createdAt",
        "updatedAt"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer's order for products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Order entity."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to the UserProfile of the client who placed the order. (Relationship: UserProfile 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "The date and time when the order was placed.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The current status of the order (e.g., 'pending', 'processing', 'shipped', 'delivered', 'cancelled')."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total monetary amount of the order, including all items."
        },
        "shippingStreetAddress": {
          "type": "string",
          "description": "The street address for shipping the order (snapshot at order time)."
        },
        "shippingCity": {
          "type": "string",
          "description": "The city for shipping the order (snapshot at order time)."
        },
        "shippingState": {
          "type": "string",
          "description": "The state or province for shipping the order (snapshot at order time)."
        },
        "shippingZipCode": {
          "type": "string",
          "description": "The postal code for shipping the order (snapshot at order time)."
        },
        "deliveryDate": {
          "type": "string",
          "description": "The estimated or actual date and time of delivery.",
          "format": "date-time"
        },
        "notes": {
          "type": "string",
          "description": "Any additional notes or instructions for the order."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the order was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the order details were last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "clientId",
        "orderDate",
        "status",
        "totalAmount",
        "shippingStreetAddress",
        "shippingCity",
        "shippingState",
        "shippingZipCode",
        "createdAt",
        "updatedAt"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents a single item within an order, detailing the product and quantity ordered. This entity serves as a junction for the N:N relationship between Order and Product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the OrderItem entity."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to the Order this item belongs to. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to the Product being ordered. (Relationship: Product 1:N OrderItem)"
        },
        "productName": {
          "type": "string",
          "description": "The name of the product at the time of order (denormalized for convenience)."
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the product ordered."
        },
        "unitPrice": {
          "type": "number",
          "description": "The price per unit of the product at the time the order was placed (for historical accuracy)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the order item was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the order item details were last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "productName",
        "quantity",
        "unitPrice",
        "createdAt",
        "updatedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/user_profiles/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores detailed business and contact information for each user. The document ID (`userId`) directly corresponds to the Firebase Authentication UID. Ownership is path-based. Note: For authorization, roles will be determined by existence in `/roles_admins` or `/roles_superadmins` collections, not by the 'role' field within this document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching their Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/roles_superadmins/{userId}",
        "definition": {
          "entityName": "roles_superadmins",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "A collection used for database-based access control (DBAC). The existence of a document with a 'userId' as its ID indicates that the user is a superadmin. This is used for global role authorization, adhering to 'Existence over Content' principle. Documents can be empty or contain minimal metadata like 'createdAt'.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (Firebase Auth UID) who has the superadmin role."
            }
          ]
        }
      },
      {
        "path": "/roles_admins/{userId}",
        "definition": {
          "entityName": "roles_admins",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "A collection used for database-based access control (DBAC). The existence of a document with a 'userId' as its ID indicates that the user is an admin. This is used for global role authorization, adhering to 'Existence over Content' principle. Documents can be empty or contain minimal metadata like 'createdAt'.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (Firebase Auth UID) who has the admin role."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "The global catalog of products available for wholesale. Clients can read all products, while admins and superadmins have read/write access. This collection has a homogeneous security posture to support QAPs.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for a product in the catalog."
            }
          ]
        }
      },
      {
        "path": "/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Represents individual customer orders. This collection is top-level to facilitate QAPs for both clients (who can query their own orders using the denormalized 'clientId' field) and admins (who can query all orders). Includes denormalized 'clientId' for authorization independence.",
          "params": [
            {
              "name": "orderId",
              "description": "The unique identifier for an order."
            }
          ]
        }
      },
      {
        "path": "/orders/{orderId}/order_items/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Represents a specific item within an order. Each document includes the 'clientId' denormalized from its parent order, ensuring authorization independence and enabling security rules to verify ownership without requiring a 'get()' call to the parent Order document.",
          "params": [
            {
              "name": "orderId",
              "description": "The unique identifier of the parent order."
            },
            {
              "name": "orderItemId",
              "description": "The unique identifier for an item within the order."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure for 'MercaFlow Portal' prioritizes Authorization Independence, debuggability, and adherence to QAPs (Query-Agnostic Permissions) through strategic denormalization and structural segregation."
  }
}
